{
  "streams": [
    {
      "sync_mode": "incremental",
      "destination_sync_mode": "overwrite",
      "stream": {
        "name": "blocks",
        "json_schema": {
          "$schema": "http://json-schema.org/draft-07/schema#",
          "type": "object",
          "anchor": {
            "name": "block",
            "pk": "{{ .Data.block.header.height }}"
          },
          "attribute": {
            "name": "raw"
          },
          "required": ["block_id", "block"],
          "properties": {
            "block_id": {
              "type": "object",
              "required": ["hash", "parts"],
              "properties": {
                "hash": {
                  "type": "string"
                },
                "parts": {
                  "required": ["total", "hash"],
                  "properties": {
                    "total": {
                      "type": "integer"
                    },
                    "hash": {
                      "type": "string"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "block": {
              "type": "object",
              "properties": {
                "header": {
                  "required": [
                    "version",
                    "chain_id",
                    "height",
                    "time",
                    "last_block_id",
                    "last_commit_hash",
                    "data_hash",
                    "validators_hash",
                    "next_validators_hash",
                    "consensus_hash",
                    "app_hash",
                    "last_results_hash",
                    "evidence_hash",
                    "proposer_address"
                  ],
                  "properties": {
                    "version": {
                      "properties": {
                        "block": {
                          "type": "string"
                        },
                        "app": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    },
                    "chain_id": {
                      "type": "string"
                    },
                    "height": {
                      "type": "string"
                    },
                    "time": {
                      "type": "string",
                      "attribute": {
                        "name": "time"
                      }
                    },
                    "last_block_id": {
                      "type": "object",
                      "required": ["hash", "parts"],
                      "properties": {
                        "hash": {
                          "type": "string"
                        },
                        "parts": {
                          "required": ["total", "hash"],
                          "properties": {
                            "total": {
                              "type": "integer"
                            },
                            "hash": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "last_commit_hash": {
                      "type": "string"
                    },
                    "data_hash": {
                      "type": "string"
                    },
                    "validators_hash": {
                      "type": "string"
                    },
                    "next_validators_hash": {
                      "type": "string"
                    },
                    "consensus_hash": {
                      "type": "string"
                    },
                    "app_hash": {
                      "type": "string"
                    },
                    "last_results_hash": {
                      "type": "string"
                    },
                    "evidence_hash": {
                      "type": "string"
                    },
                    "proposer_address": {
                      "type": "string"
                    }
                  },
                  "type": "object"
                },
                "data": {
                  "type": "object",
                  "required": ["tx_count"],
                  "properties": {
                    "tx_count": {
                      "type": "string",
                      "attribute": {
                        "name": "tx_count",
                        "value": "{{ len .Parent.Data.txs }}"
                      }
                    },
                    "txs": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "decode_service": {
                          "url": "{{ env \"DECODE_SERVICE_URL\" }}",
                          "body": "{{ .Data }}"
                        },
                        "required": ["hash"],
                        "anchor": {
                          "name": "tx",
                          "pk": "{{ .AnchorID }}:{{ .Idx }}"
                        },
                        "attribute": {
                          "name": "raw"
                        },
                        "properties": {
                          "hash": {
                            "type": "string",
                            "attribute": {
                              "name": "hash",
                              "value": "{{ .Parent.Parent.Parent.Data | sha256sum | upper }}"
                            }
                          },
                          "body": {
                            "type": "object",
                            "required": ["messages"],
                            "properties": {
                              "messages": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "required": ["type", "payload"],
                                  "anchor": {
                                    "name": "{{ index .Data \"@type\" }}",
                                    "pk": "{{ .AnchorID }}:{{ .Idx }}"
                                  },
                                  "attribute": {
                                    "name": "body"
                                  },
                                  "properties": {
                                    "@type": {
                                      "type": "string"
                                    }
                                  }
                                }
                              },
                              "memo": {
                                "type": "string"
                              },
                              "timeout_height": {
                                "type": "string"
                              }
                            }
                          },
                          "auth_info": {
                            "type": "object",
                            "properties": {
                              "signer_infos": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "public_key": {
                                      "type": "object",
                                      "properties": {
                                        "@type": {
                                          "type": "string"
                                        },
                                        "key": {
                                          "type": "string"
                                        }
                                      }
                                    },
                                    "mode_info": {
                                      "type": "object",
                                      "properties": {
                                        "single": {
                                          "type": "object",
                                          "properties": {
                                            "mode": {
                                              "type": "string"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "sequence": {
                                      "type": "string"
                                    }
                                  }
                                }
                              },
                              "fee": {
                                "type": "object",
                                "properties": {
                                  "amount": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "denom": {
                                          "attribute": {
                                            "name": "fee_amount_denom"
                                          },
                                          "type": "string"
                                        },
                                        "amount": {
                                          "attribute": {
                                            "name": "fee_amount"
                                          },
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "gas_limit": {
                                    "attribute": {
                                      "name": "gas_limit"
                                    },
                                    "type": "string"
                                  },
                                  "payer": {
                                    "type": "string"
                                  },
                                  "granter": {
                                    "type": "string"
                                  }
                                }
                              }
                            }
                          },
                          "signatures": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "evidence": {
                  "type": "object",
                  "properties": {
                    "evidence": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string"
                          },
                          "height": {
                            "type": "integer"
                          },
                          "time": {
                            "type": "integer"
                          },
                          "total_voting_power": {
                            "type": "integer"
                          },
                          "validator": {
                            "type": "object",
                            "properties": {
                              "pub_key": {
                                "type": "object",
                                "properties": {
                                  "type": {
                                    "type": "string"
                                  },
                                  "value": {
                                    "type": "string"
                                  }
                                }
                              },
                              "voting_power": {
                                "type": "integer"
                              },
                              "address": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "last_commit": {
                  "type": "object",
                  "properties": {
                    "height": {
                      "type": "string"
                    },
                    "round": {
                      "type": "integer"
                    },
                    "block_id": {
                      "type": "object",
                      "required": ["hash", "parts"],
                      "properties": {
                        "hash": {
                          "type": "string"
                        },
                        "parts": {
                          "required": ["total", "hash"],
                          "properties": {
                            "total": {
                              "type": "integer"
                            },
                            "hash": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "signatures": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": ["timestamp", "validator_address", "signature"],
                        "properties": {
                          "type": {
                            "type": "integer"
                          },
                          "height": {
                            "type": "string"
                          },
                          "round": {
                            "type": "integer"
                          },
                          "block_id": {
                            "type": ["object", "null"],
                            "required": ["hash", "parts"],
                            "properties": {
                              "hash": {
                                "type": "string"
                              },
                              "parts": {
                                "required": ["total", "hash"],
                                "properties": {
                                  "total": {
                                    "type": "integer"
                                  },
                                  "hash": {
                                    "type": "string"
                                  }
                                },
                                "type": "object"
                              }
                            }
                          },
                          "timestamp": {
                            "type": "string"
                          },
                          "validator_address": {
                            "type": "string"
                          },
                          "validator_index": {
                            "type": "integer"
                          },
                          "signature": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "supported_sync_modes": ["full_refresh"],
        "source_defined_cursor": true,
        "default_cursor_field": ["id"],
        "primary_key": ["id"]
      }
    },
    {
      "sync_mode": "incremental",
      "destination_sync_mode": "overwrite",
      "stream": {
        "name": "block_results",
        "json_schema": {
          "$schema": "http://json-schema.org/draft-07/schema#",
          "type": "object",
          "external_parent_anchor": {
            "name": "block",
            "pk": "{{ .Data.height }}"
          },
          "attribute": {
            "name": "raw_results"
          },
          "required": ["height"],
          "properties": {
            "height": {
              "type": "string"
            },
            "txs_results": {
              "type": ["array", "null"],
              "items": {
                "type": "object",
                "anchor": {
                  "name": "tx_result",
                  "pk": "{{ .AnchorID }}:{{ .Idx }}"
                },
                "properties": {
                  "code": {
                    "type": "number"
                  },
                  "data": {
                    "type": "string"
                  },
                  "log": {
                    "type": "string"
                  },
                  "info": {
                    "type": "string"
                  },
                  "gas_wanted": {
                    "type": "string"
                  },
                  "gas_used": {
                    "type": "string"
                  },
                  "events": {
                    "type": ["array", "null"],
                    "items": {
                      "type": "object",
                      "anchor": {
                        "name": "{{ .Data.type }}_event",
                        "pk": "{{ .AnchorID }}:{{ .Idx }}"
                      },
                      "properties": {
                        "type": {
                          "type": "string"
                        },
                        "attributes": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "key": {
                                "type": "string"
                              },
                              "value": {
                                "attribute": {
                                  "name": "{{ .Parent.Data.key | b64dec }}",
                                  "value": "{{if not .Data}}==NULL=={{else}}{{ .Data | b64dec }}{{end}}"
                                },
                                "type": ["string", "null"]
                              },
                              "index": {
                                "type": "boolean"
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "codespace": {
                    "type": "string"
                  }
                }
              }
            },
            "begin_block_events": {
              "type": ["array", "null"],
              "items": {
                "type": "object",
                "anchor": {
                  "name": "begin_block_{{ .Data.type }}_event",
                  "pk": "{{ .AnchorID }}:{{ .Idx }}"
                },
                "properties": {
                  "type": {
                    "type": "string"
                  },
                  "attributes": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "key": {
                          "type": "string"
                        },
                        "value": {
                          "attribute": {
                            "name": "{{ .Parent.Data.key | b64dec }}",
                            "value": "{{if not .Data}}==NULL=={{else}}{{ .Data | b64dec }}{{end}}"
                          },
                          "type": ["string", "null"]
                        },
                        "index": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                }
              }
            },
            "end_block_events": {
              "type": ["array", "null"],
              "items": {
                "type": "object",
                "anchor": {
                  "name": "end_block_{{ .Data.type }}_event",
                  "pk": "{{ .AnchorID }}:{{ .Idx }}"
                },
                "properties": {
                  "type": {
                    "type": "string"
                  },
                  "attributes": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "key": {
                          "type": "string"
                        },
                        "value": {
                          "attribute": {
                            "name": "{{ .Parent.Data.key | b64dec }}",
                            "value": "{{if not .Data}}==NULL=={{else}}{{ .Data | b64dec }}{{end}}"
                          },
                          "type": ["string", "null"]
                        },
                        "index": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                }
              }
            },
            "validator_updates": {
              "type": ["array", "null"],
              "items": {
                "type": "object",
                "properties": {
                  "pub_key": {
                    "type": "object",
                    "required": ["type", "value"],
                    "properties": {
                      "type": {
                        "type": "string"
                      },
                      "value": {
                        "type": "string"
                      }
                    }
                  },
                  "power": {
                    "type": "string"
                  }
                }
              }
            },
            "consensus_params_updates": {
              "type": ["object", "null"],
              "required": ["block", "evidence", "validator"],
              "properties": {
                "block": {
                  "type": "object",
                  "required": ["max_bytes", "max_gas", "time_iota_ms"],
                  "properties": {
                    "max_bytes": {
                      "type": "string"
                    },
                    "max_gas": {
                      "type": "string"
                    },
                    "time_iota_ms": {
                      "type": "string"
                    }
                  }
                },
                "evidence": {
                  "type": "object",
                  "required": ["max_age"],
                  "properties": {
                    "max_age": {
                      "type": "string"
                    }
                  }
                },
                "validator": {
                  "type": "object",
                  "required": ["pub_key_types"],
                  "properties": {
                    "pub_key_types": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "supported_sync_modes": ["full_refresh"],
        "source_defined_cursor": true,
        "default_cursor_field": ["id"],
        "primary_key": ["id"]
      }
    },
    {
      "sync_mode": "incremental",
      "destination_sync_mode": "overwrite",
      "stream": {
        "name": "validators",
        "json_schema": {
          "$schema": "http://json-schema.org/draft-07/schema#",
          "type": "object",
          "external_parent_anchor": {
            "name": "block",
            "pk": "{{ .Data.block_height }}"
          },
          "attribute": {
            "name": "raw_validators"
          },
          "properties": {
            "block_height": {
              "type": "string"
            },
            "validators": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["address", "voting_power"],
                "anchor": {
                  "name": "validator",
                  "pk": "{{ .Parent.Parent.Data.block_height }}:{{ .Data.address }}"
                },
                "properties": {
                  "address": {
                    "type": "string"
                  },
                  "pub_key": {
                    "required": ["type", "value"],
                    "properties": {
                      "type": {
                        "type": "string",
                        "attribute": {
                          "name": "pub_key_type"
                        }
                      },
                      "value": {
                        "type": "string",
                        "attribute": {
                          "name": "pub_key_value"
                        }
                      }
                    },
                    "type": "object"
                  },
                  "voting_power": {
                    "type": "string",
                    "attribute": {
                      "name": "voting_power"
                    }
                  },
                  "proposer_priority": {
                    "type": "string",
                    "attribute": {
                      "name": "voting_power"
                    }
                  }
                }
              }
            }
          }
        },
        "supported_sync_modes": ["full_refresh"],
        "source_defined_cursor": true,
        "default_cursor_field": ["id"],
        "primary_key": ["id"]
      }
    }
  ]
}
